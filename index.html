<!doctype html>
<html lang="zh-cmn-Hans">

<head>
    <meta charset="utf-8" name="viewport"
        content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0" />
    <title>订阅转换
    </title>
    <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/mdui/1.0.1/css/mdui.min.css">
    <script src="https://cdn.bootcdn.net/ajax/libs/mdui/1.0.1/js/mdui.min.js"></script>
    <script>var $ = mdui.$;</script>
</head>

<body id="setdarkmodeclass" class="mdui-theme-primary-deep-purple mdui-theme-accent-indigo">
    <div class="mdui-container mdui-typo">
        <div class="mdui-card">
            <!-- 卡片的标题和副标题 -->
            <div class="mdui-card-primary">
                <div class="mdui-card-primary-title">MDUI SubGUI</div>
                <div class="mdui-card-primary-subtitle">subconverter的可视化使用界面</div>

            </div>

            <!-- 卡片的内容 -->
            <div class="mdui-card-content">

                <div>
                    <h3>说明</h3>
                    <p>1.后端使用<a href="/tindy2013/subconverter">subconverter</a><br>2.源订阅链接支持类型: Clash
                        ，ClashR
                        ，Quantumult (完整配置)
                        ，Quantumult X (完整配置)
                        ，Loon
                        ，Mellow
                        ，SS (SIP002)
                        ，SS (软件订阅)
                        ，SSD
                        ，SSR
                        ，Surfboard
                        ，Surge
                        ，Surge
                        ，Surge
                        ，Trojan
                        ，V2Ray
                        <br>3.请勿滥用，若遇频繁请求则可能封IP
                    </p>
                    <h3>配置</h3>
                    <div class="mdui-row">

                        <div class="mdui-textfield mdui-textfield-floating-label mdui-col-sm-6">
                            <h5>源订阅链接</h5>
                            <label class="mdui-textfield-label">填写订阅链接或 ss:// 等节点链接</label>
                            <input class="mdui-textfield-input" type="text" id="subinput" />
                        </div>
                        <div class="mdui-textfield mdui-textfield-floating-label mdui-col-sm-6">
                            <h5>配置文件名称</h5>
                            <label class="mdui-textfield-label">作为clash等策略组软件的配置文件名</label>
                            <input class="mdui-textfield-input" type="text" id="subNameInput" value="sub" />
                        </div>
                    </div>
                    <div class="mdui-row">
                        <form name="subInputform">
                            <div class="mdui-col-sm-3 mdui-col-md-2">
                                <h5>后端地址</h5>
                                <select id="subServerSideInputSelect" class="mdui-select"
                                    mdui-select="{position: 'top'}">
                                    <option value="subapi.666old666.cn">落日余晖</option>
                                    <option value="subcon.dlj.tf">subconverter作者</option>
                                    <option value="api.v1.mk">肥羊</option>
                                    <option value="api.wcc.best">sub-web作者</option>
                                    <option value="sub.id9.cc">品云</option>
                                    <option value="">自定义</option>
                                </select>
                            </div>
                            <div class="mdui-textfield mdui-textfield-floating-label mdui-col-sm-3 mdui-col-md-4"
                                style="margin-top: 13px">

                                <label class="mdui-textfield-label">自定义后端url</label>
                                <input class="mdui-textfield-input" type="text" id="subServerSideInput"
                                    value="subapi.666old666.cn" />

                            </div>
                            <div class="mdui-col-sm-3  mdui-col-md-2">
                                <h5>远程配置</h5>
                                <select id="subConfigInputSelect" class="mdui-select" mdui-select="{position: 'top'}">
                                    <option
                                        value="https://github.com/RSSYLY/rssylySCTrules/raw/master/config/rssyly1.ini">
                                        落日余晖</option>
                                    <option value="subcon.dlj.tf">subconverter作者</option>
                                    <option value="api.v1.mk">肥羊</option>
                                    <option value="api.wcc.best">sub-web作者</option>
                                    <option value="sub.id9.cc">品云</option>
                                    <option value="">自定义</option>
                                </select>
                            </div>
                            <div class="mdui-textfield mdui-textfield-floating-label mdui-col-sm-3 mdui-col-md-4"
                                style="margin-top: 13px">

                                <label class="mdui-textfield-label">文件路径或内容</label>
                                <input class="mdui-textfield-input" type="text" id="subConfigInput" value="" />
                            </div>
                        </form>
                    </div>
                    <div class="mdui-row">
                        <div class="mdui-col-sm-6">
                            <h5>输出类型</h5>
                            <select id="subOutputType" class="mdui-select" mdui-select="{position: 'top'}">
                                <option value="&target=clash">Clash</option>
                                <option value="&target=v2ray">V2ray</option>
                                <option value="&target=surfboard">Surfboard</option>
                                <option value="&target=quan">Quantumult</option>
                                <option value="&target=quanx">Quantumult X</option>
                                <option value="&target=ssr">SSR</option>
                            </select>
                        </div>

                    </div>

                    <div class="mdui-row">
                        <div class="mdui-col-sm-4">
                            <h5>启用UDP </h5>
                            <label class="mdui-switch">
                                <input id="udpEnableSwich" type="checkbox" />
                                <i class="mdui-switch-icon"></i>
                            </label>
                        </div>
                        <div class="mdui-col-sm-4">
                            <h5>节点名添加emoji国旗 </h5>
                            <label class="mdui-switch">
                                <input id="addemojiEnableSwich" type="checkbox" checked />
                                <i class="mdui-switch-icon"></i>
                            </label>
                        </div>
                        <div class="mdui-col-sm-4">
                            <h5>节点名添加协议类型 </h5>
                            <label class="mdui-switch">
                                <input id="appendtypeEnableSwich" type="checkbox" />
                                <i class="mdui-switch-icon"></i>
                            </label>
                        </div>
                    </div>



                </div>

            </div>

            <!-- 卡片的按钮 -->
            <div class="mdui-card-actions">
                <button class="mdui-btn mdui-ripple" id="subbtn">生成</button>
                <button class="mdui-btn mdui-btn-icon mdui-float-right"><i class="mdui-icon material-icons"
                        onclick="window.open('https://github.com/RSSYLY/mdui-subgui');">comment</i></button>
            </div>

        </div>



        <div class="mdui-dialog" id="subapi">
            <div class="mdui-dialog-title">生成的订阅链接</div>
            <div class="mdui-dialog-content">
                <form name="outputform">
                    <div class="mdui-textfield">
                        <input id="output" class="mdui-textfield-input" type="text" name="outputinput" />
                    </div>
                </form>
            </div>
            <div class="mdui-dialog-actions">
                <button class="mdui-btn mdui-ripple" mdui-dialog-cancel>取消</button>
                <button class="mdui-btn mdui-ripple" id="copyBtn">复制</button>
            </div>
        </div>
    </div>
    <script>document.getElementById('subbtn').addEventListener('click', function () {

            // 定义变量 值为后端地址
            var subServerSide = document.getElementById("subServerSideInput").value;

            //定义变量，值为输入源订阅链接表单
            var inPut = document.getElementById("subinput").value;

            // 定义变量，值为生成配置文件名
            var subName = "&filename=" + document.getElementById("subNameInput").value;

            // 定义变量 值为远程配置
            var subConfig = document.getElementById("subConfigInput").value;
            // 值若为空，则赋值使用默认配置文件
            if (subConfig == null || subConfig == "") {
                var subConfig = "https://github.com/RSSYLY/rssylySCTrules/raw/master/config/rssyly1.ini"
            }


            // 定义变量，设置输出类型
            var outPutType = document.getElementById("subOutputType").value;

            // 定义变量，设置 udp 开关
            var udpEnable = "&udp=" + document.getElementById("udpEnableSwich").checked;

            // 定义变量 设置 节点前添加emoji国旗
            var addemojiEnable = "&add_emoji=" + document.getElementById("addemojiEnableSwich").checked;

            // 定义变量 设置 节点前加节点协议类型
            var appendtypeEnable = "&append_type=" + document.getElementById("appendtypeEnableSwich").checked;


            // 检测表单是否为空，若是则报错
            if (inPut == null || inPut == "") {
                mdui.snackbar({
                    message: '错误:请填写源链接',
                    position: 'right-top'
                });
                return false;
            }



            // 定义新对话框
            var inst = new mdui.Dialog('#subapi');

            // 定义函数，值为后端地址 &target=clash
            var sub = "https://" + subServerSide + "/sub?insert=true&emoji=true&list=false&url="

            // 合并订阅链接
            inPut = sub + encodeURIComponent(inPut) + outPutType + udpEnable + subName + addemojiEnable + appendtypeEnable + "&config=" + encodeURIComponent(subConfig);

            // 将输出链接写入对话框的表单
            outputform.outputinput.value = inPut;

            // 打开对话框
            inst.open();
        });
    </script>

    <script type="text/javascript">
        /*判断是否处于深色模式*/
        if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
            //Do some thing
            //测试用 console.log('点击了元素');
            //js添加指定id的class
            document.getElementById("setdarkmodeclass").classList.add("mdui-theme-layout-dark");
            // document.getElementById("left-drawer").classList.add(//"mystyle", "anotherClass","mdui-theme-layout-dark");
            //js删除指定id的class
            // document.getElementById("setdarkmodeclass2").classList.remove("mdui-color-theme-800");
            // document.getElementById("left-drawer").classList.remove("mdui-color-white");
            // document.getElementById("setdarkmodesetting").classList.remove("setdarkmodesetting");

        }</script>
    <script type="text/javascript">function switchserve() {
            var divP = document.getElementById("mainsb");
            document.write("")
        }
    </script>
    <script>
        // 复制生成链接
        const btn = document.querySelector('#copyBtn');
        btn.addEventListener('click', () => {
            const input = document.querySelector('#output');
            input.select();
            if (document.execCommand('copy')) {
                document.execCommand('copy');
                mdui.snackbar({
                    message: '已复制至剪切板',
                    position: 'right-top'
                });
            }
        })</script>
    <script>
        // 触发事件,当后端地址subServerSideInputSelect下拉选择关闭时

        $('#subServerSideInputSelect').on('close.mdui.select', function () {
            var subServerSideInputSelect_value = document.getElementById("subServerSideInputSelect").value;

            // 将预设后端地址写入后端地址的表单，格式 formName.inputID.value = xxx 
            subInputform.subServerSideInput.value = subServerSideInputSelect_value;

            if (subServerSideInputSelect_value == null || subServerSideInputSelect_value == "") {
                // document.getElementsByClassName()[1].setAttribute("","")
                document.getElementById("subServerSideInput").removeAttribute("disabled")
            } else {

                document.getElementById("subServerSideInput").setAttribute("disabled", "3");
            }

        });

        // 触发事件,当后端地址subServerSideInputSelect下拉选择关闭时
        $('#subConfigInputSelect').on('close.mdui.select', function () {
            var subConfigInputSelect_value = document.getElementById("subConfigInputSelect").value;

            // 将预设后端地址写入后端地址的表单，格式 formName.inputID.value = xxx 
            subInputform.subConfigInput.value = subConfigInputSelect_value;

            if (subConfigInputSelect_value == null || subConfigInputSelect_value == "") {
                // document.getElementsByClassName()[1].setAttribute("","")
                document.getElementById("subConfigInput").removeAttribute("disabled")
            } else {

                document.getElementById("subConfigInput").setAttribute("disabled", "3");
            }

        });
    </script>
    <script>
        var subServerSideInputSelect_value = document.getElementById("subServerSideInputSelect").value;

        // 将预设后端地址写入后端地址的表单，格式 formName.inputID.value = xxx 
        subInputform.subServerSideInput.value = subServerSideInputSelect_value;

        if (subServerSideInputSelect_value == null || subServerSideInputSelect_value == "") {
            // document.getElementsByClassName()[1].setAttribute("","")
            document.getElementById("subServerSideInput").removeAttribute("disabled")
        } else {

            document.getElementById("subServerSideInput").setAttribute("disabled", "3");
        }

        var subConfigInputSelect_value = document.getElementById("subConfigInputSelect").value;

        // 将预设后端地址写入后端地址的表单，格式 formName.inputID.value = xxx 
        subInputform.subConfigInput.value = subConfigInputSelect_value;

        if (subConfigInputSelect_value == null || subConfigInputSelect_value == "") {
            // document.getElementsByClassName()[1].setAttribute("","")
            document.getElementById("subConfigInput").removeAttribute("disabled")
        } else {

            document.getElementById("subConfigInput").setAttribute("disabled", "3");
        }

    </script>

    <script src="https://cdn.bootcdn.net/ajax/libs/mdui/1.0.1/js/mdui.min.js"></script>

</body>


</html>